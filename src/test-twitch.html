<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Twitch Status Test</title>
  </head>
  <body>
    <h1>Twitch Status Test</h1>
    <div id="status">Loading...</div>

    <script>
      async function fetchTwitchStatus() {
        const statusElement = document.getElementById("status");

        try {
          const response = await fetch(
            "https://decapi.me/twitch/status/schildflieger"
          );

          if (response.ok) {
            const data = await response.text();
            console.log("Raw response:", data);

            // DecAPI returns "Username is offline" or "Username is streaming: Title (Game) for HH:MM:SS with N viewers"
            const isLive = !data.includes("is offline");

            if (isLive) {
              // Extract viewer count if available
              const viewerMatch = data.match(/with ([0-9,]+) viewers/);
              const viewers = viewerMatch
                ? parseInt(viewerMatch[1].replace(",", ""))
                : 0;
              statusElement.textContent = `LIVE${
                viewers ? " | " + viewers + " viewers" : ""
              }`;
            } else {
              statusElement.textContent = "Offline";
            }
          } else {
            throw new Error("Failed to fetch status");
          }
        } catch (error) {
          console.error("Error fetching Twitch status:", error);
          statusElement.textContent = "Error loading status";
        }
      }

      fetchTwitchStatus();
    </script>
  </body>
</html>
