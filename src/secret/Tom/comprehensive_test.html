<!DOCTYPE html>
<html>
  <head>
    <title>Comprehensive Like System Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .test-section {
        background: white;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .test-result {
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .like-button {
        background: #333;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        margin: 10px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .like-button.liked {
        color: red;
      }
      @keyframes likePulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.3);
        }
        100% {
          transform: scale(1);
        }
      }
      .like-button.liked-animation {
        animation: likePulse 0.5s ease;
      }
    </style>
  </head>
  <body>
    <h1>Comprehensive Like System Test</h1>

    <div class="test-section">
      <h2>Frontend JavaScript Tests</h2>
      <button id="testDomReady">Test DOM Ready</button>
      <button id="testButtonClick">Test Button Click</button>
      <button id="testFetchApi">Test Fetch API</button>
      <div id="frontendResults"></div>
    </div>

    <div class="test-section">
      <h2>Backend Connection Tests</h2>
      <button id="testGetLikes">Test Get Likes</button>
      <button id="testLikeHandler">Test Like Handler</button>
      <div id="backendResults"></div>
    </div>

    <div class="test-section">
      <h2>Integrated Like Test</h2>
      <button class="like-button" data-filename="Amena Tom.mp4">
        <span class="heart">❤️</span> <span class="like-count">0</span>
      </button>
      <div id="integratedResults"></div>
    </div>

    <script>
      // Test variables
      let testPassed = 0;
      let testFailed = 0;

      // Utility function to add test result
      function addTestResult(containerId, message, isSuccess) {
        const container = document.getElementById(containerId);
        const resultDiv = document.createElement("div");
        resultDiv.className = `test-result ${isSuccess ? "success" : "error"}`;
        resultDiv.textContent = `${isSuccess ? "✓" : "✗"} ${message}`;
        container.appendChild(resultDiv);

        if (isSuccess) {
          testPassed++;
        } else {
          testFailed++;
        }
      }

      // Frontend Tests
      document
        .getElementById("testDomReady")
        .addEventListener("click", function () {
          const containerId = "frontendResults";
          document.getElementById(containerId).innerHTML = "";

          try {
            if (document.readyState === "loading") {
              addTestResult(containerId, "DOM is still loading", false);
            } else {
              addTestResult(containerId, "DOM is ready", true);
            }
          } catch (error) {
            addTestResult(containerId, `Error: ${error.message}`, false);
          }
        });

      document
        .getElementById("testButtonClick")
        .addEventListener("click", function () {
          const containerId = "frontendResults";
          document.getElementById(containerId).innerHTML = "";

          try {
            addTestResult(containerId, "Button click event works", true);
          } catch (error) {
            addTestResult(containerId, `Error: ${error.message}`, false);
          }
        });

      document
        .getElementById("testFetchApi")
        .addEventListener("click", function () {
          const containerId = "frontendResults";
          document.getElementById(containerId).innerHTML = "";

          try {
            if (typeof fetch !== "undefined") {
              addTestResult(containerId, "Fetch API is available", true);
            } else {
              addTestResult(containerId, "Fetch API is not available", false);
            }
          } catch (error) {
            addTestResult(containerId, `Error: ${error.message}`, false);
          }
        });

      // Backend Tests
      document
        .getElementById("testGetLikes")
        .addEventListener("click", function () {
          const containerId = "backendResults";
          document.getElementById(containerId).innerHTML =
            '<div class="test-result info">Testing...</div>';

          fetch("/secret/Tom/get_likes.php")
            .then((response) => {
              document.getElementById(containerId).innerHTML = "";
              addTestResult(
                containerId,
                `Response status: ${response.status}`,
                response.ok
              );
              return response.json();
            })
            .then((data) => {
              addTestResult(
                containerId,
                `Response data: ${JSON.stringify(data)}`,
                data.success === true
              );
            })
            .catch((error) => {
              document.getElementById(containerId).innerHTML = "";
              addTestResult(containerId, `Error: ${error.message}`, false);
            });
        });

      document
        .getElementById("testLikeHandler")
        .addEventListener("click", function () {
          const containerId = "backendResults";
          document.getElementById(containerId).innerHTML =
            '<div class="test-result info">Testing...</div>';

          fetch("/secret/Tom/like_handler.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ filename: "test_file.mp4" }),
          })
            .then((response) => {
              document.getElementById(containerId).innerHTML = "";
              addTestResult(
                containerId,
                `Response status: ${response.status}`,
                response.ok
              );
              return response.json();
            })
            .then((data) => {
              addTestResult(
                containerId,
                `Response data: ${JSON.stringify(data)}`,
                data.success === true
              );
            })
            .catch((error) => {
              document.getElementById(containerId).innerHTML = "";
              addTestResult(containerId, `Error: ${error.message}`, false);
            });
        });

      // Integrated Like Test
      document
        .querySelector(".like-button")
        .addEventListener("click", function () {
          const containerId = "integratedResults";
          document.getElementById(containerId).innerHTML =
            '<div class="test-result info">Liking...</div>';

          const filename = this.getAttribute("data-filename");
          const likeCountElement = this.querySelector(".like-count");

          fetch("/secret/Tom/like_handler.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ filename: filename }),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              document.getElementById(containerId).innerHTML = "";
              if (data.success) {
                addTestResult(
                  containerId,
                  `Like successful! New count: ${data.like_count}`,
                  true
                );
                likeCountElement.textContent = data.like_count;

                // Add animation
                this.classList.add("liked");
                this.classList.add("liked-animation");
                setTimeout(() => {
                  this.classList.remove("liked-animation");
                }, 500);
              } else {
                addTestResult(containerId, `Like failed: ${data.error}`, false);
              }
            })
            .catch((error) => {
              document.getElementById(containerId).innerHTML = "";
              addTestResult(containerId, `Error: ${error.message}`, false);
            });
        });
    </script>
  </body>
</html>
